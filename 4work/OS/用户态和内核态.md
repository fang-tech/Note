# OS

## 什么是用户态和内核态

> 这个概念是以进程访问资源的特点为依据进行的划分, 将进程在操作系统上的运行分为两个级别, **是为了安全和管理而设计**

- **用户态(User Mode) :** 用户态运行的程序能直接读取用户程序的数据, 拥有较低的权限.
    - 不能直接访问内核数据和程序
    - 操作系统在执行用户程序时, **主要**工作在用户态, 只有在执行没有权限完成的任务的时候才会切换到内核态
    - 访客模式
- **内核态(Kernel Mode) :** 内核态运行的进程几乎可以访问计算机中的任何资源, 不受控制, 拥有非常高的权限
    - 可以访问任何有效的地址
    - 管理员模式
## 为什么要区分内核态和用户态

1. 安全性 : 内核程序和用户程序的运行环境分隔, 有助于防止用户程序对系统造成不可修复的破坏, 会对系统的正常运行造成灾难性的影响.
    - 这些危险指令智能在内核态运行, 这些只能由操作系统内核执行的指令也被叫做 **特权指令**
2. 稳定性 : 应用程序错误只会影响到该程序本身, 而不会导致整个系统崩坏

## 用户态和内核态是如何切换的

1. **系统调用** : 用户态进程 **主动** 要求切换到内核态的一种方式, 主要是为了使用内核态才能做的事情, 比如读取磁盘资源. 
    - 实现 : 操作系统为用户特别开放了一个中断
    - 比如用户态程序发起 `read()` 请求读取硬盘数据, 就会从用户态切换到内核态
2. **中断** : 当外围设备完成用户请求的操作后, 会向CPU发出相应的中断信号, 这个时候CPU会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序
    - 如果之前执行的是用户态, 而中断处理程序执行的内容是内核态的程序, 这个时候, 我们就发生了从用户态到内核态的切换. 
    - 我们完成了对磁盘数据的读取的时候, 操作系统就会向cpu发送一个中断, 让cpu能继续运行原先的等待的用户程序
3. **异常** : 当CPU在执行运行在用户态下的程序时, 发生了某些事先不可知的异常, 这时就会触发由当前运行进程切换到处理此异常的内核相关程序中
    - 比如缺页异常
