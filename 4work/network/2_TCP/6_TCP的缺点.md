# 为什么要基于UDP实现可靠传输 (TCP的缺点)

最大的原因就是TCP不是没有缺点的, 只是看似完美, 甚至正是TCP的缺点导致了HTTP2的瓶颈

TCP有四大缺点

## 升级TCP的工作困难

TCP协议是在内核中实现的, 应用程序只能使用不能修改, 如果想升级TCP协议, 只能升级内核, 升级内核的成本是很高的(升级, 测试, 考虑兼容性....), 并且如果想使用升级的TCP协议, 需要通信双端都升级, 进一步加大了升级TCP的难度

## TCP建立连接的延迟

基于TCP实现的应用层协议, 都需要经过三次握手后

常用的HTTPS, 甚至需要在TCP三次握手以后, 还需要经过TLS四次握手, 才能进行HTTP数据的传输, 增加了数据传输的延迟

![](https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZfxxjvoTicwpUmESgBvvjqH5pTRIcm9HNfkQQTGMK7cUibEnGhBgLLJvkwp7SPndQv26fudMJIMGb7Q/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

最后最少需要6次握手环节才能开始HTTP数据的传输

## TCP存在队头堵塞

TCP队头堵塞的原因 : TCP需要保证数据**按序交付**

- 如果TCP发送端发送的某条数据丢失了, 会导致接收窗口的**左边界堵塞**在丢失的数据上, 不能滑动(右边界还是可以继续滑动的, 使窗口保持原有的大小或根据接收缓冲区空间调整), 
- 同时使序列号更高的数据接收到了, 但是因为**低序列的数据没有接收到, 这些数据也不会交付给应用层, 直到丢失的数据被重传并接收**

HTTP/2虽然解决的HTTP/1.1的队头堵塞问题(如果某一条HTTP数据请求被堵塞了, 没有接收到响应, 后面的请求也只能等待), 但是因为是基于TCP实现的应用层协议, 无法解决TCP的队头堵塞问题

## 网络迁移需要重新建立TCP连接

因为TCP是通过四元组来确定一条TCP连接的

如果IP地址发生了变化, 就必须要断开所有的TCP连接, 然后重新建立TCP连接