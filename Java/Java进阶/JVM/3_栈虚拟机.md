# 栈虚拟机

## 虚拟机栈

方法调用和执行过程中的数据(如局部变量和中间值)会存储在栈(操作数栈)中, 字节码指令操作这些数据, 然后程序执行逻辑

![img](https://cdn.tobebetterjavaer.com/stutymore/how-run-java-code-20231031143842.png)

JVM在执行代码的时候, 会将main方法对应的栈帧压进虚拟机栈, 一个栈帧包括了

- 局部变量表 : 存在堆中
- 方法返回地址
- 操作数栈 : 从字节码执行引擎获取指令和数据
- 动态链接
- 一些附加信息

在Java中每一个线程都有自己的虚拟机栈, 是线程私有的. 方法调用的时候都会创建一个新的栈帧, 该栈被推进虚拟机栈, 成为当前活动栈帧

- 入栈 : 方法调用的时候, 虚拟机栈会为这个方法分配一个栈帧, 这个栈帧会被压入到虚拟机栈, 成为当前的活动栈帧, PC寄存器指向当前栈帧的指令, 执行方法的指令序列从该地址开始
- 出栈 : 方法执行完成以后, 对应的栈帧会被移除, 控制权回到前一个栈帧, 前一个栈帧中的返回值成为当前活动栈帧的一个操作数, 继续执行

## 操作数栈

操作数栈用于保存方法执行时的中间结果, 参数和返回值, 被用于执行各种字节码指令

比如执行两个数相加的指令就是将两个操作数从操作数栈中弹出, 然后相加, 将结果压入操作数栈中

操作数栈的生命周期和方法的生命周期是一样的, 方法执行完毕以后, 操作数栈也会被销毁