# 实现了什么

## 库表设计

> 因为账户可用抽奖次数, 为了应对复杂的实际需求, 我们是为一个账户设置了日次数, 月次数, 总次数的限制, 这个时候如果我们在扣减额度的时候是扣减这张账户表中的次数, 则还需要在特定的时间恢复库存

- 这个时候我们还要额外记录我们要恢复的次数数量 (因为这个次数是可能会发生变化的, 比如有什么奖励是增加最大抽奖次数) 
- 所以我们干脆直接再设置一个表, 用于存储用户可用的次数的表, 我们在这个表中执行扣减, 原先的表就相当于一个镜像表(就像我们记录了最大生命值一样, 然后在新的游戏中扣减生命值, 新的游戏再恢复)

## TODO

- 扣减额度的库表任务很明显和用户订单需要在一个事务中完成 (通过聚合对象 + 事务实现?)
- 获取到订单了以后, 通过抽奖策略计算, 我们得到抽奖奖品
- 将抽到的奖品通过发送MQ发送出去
    - 维护一个task表, 依靠task表的备份, 我们通过定时job扫描task表, 重新发送未成功的MQ消息