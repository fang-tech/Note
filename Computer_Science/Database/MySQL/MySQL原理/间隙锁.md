
## 间隙锁

### 为什么需要间隙锁

> 解决的核心问题是幻读现象 : 在同一次事务中, 两次相同的查询最后的结果却不一样

- 举例说明间隙锁解决幻读现象
    - 范围问题
    - 事务A : 查询银行账户中所有的余额 > 500的账户, 执行后续业务
    - 事务B : 添加一个余额600的账户 
        - 如果没有间隙锁 : 在执行完查询以后, 执行后续业务之前, 执行了事务B, 这个时候, 事务A中的查询结果其实是错误的, 少查了一个余额 > 500 的账户
        - 通过间隙锁解决 : 在事务A执行了查询以后, 数据库为除了已经查询到的账户以外的所有范围加上间隙锁, 其他的事务如果在加锁以后进行查询, 会阻塞等待间隙锁释放

    - 唯一性检查
    - 事务A : 查询学生表中有没有学号为003的数据, 如果没有则添加这个学生的数据
    - 事务B  : 为学生表添加学号为003的学生的数据, 如果这个学生不存在的话
        - 如果没有间隙锁 : 在事务A执行了查询以后, 事务B将这个学生添加进去了, 然后事务A又添加了一次
        - 通过间隙锁解决 : 在查询以后事务A为学号索引003加上间隙锁, 事务B在添加的时候碰到了锁, 阻塞等待事务A结束, 事务A结束以后, 事务B再执行添加因为数据库中已经有了数据, 插入失败

> 间隙锁保证了查询结果在一次事务中的一致性

### 什么是间隙锁

- 

### 间隙锁在这里会导致的问题

### 如何解决间隙锁问题